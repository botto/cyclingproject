{"ast":null,"code":"const sortFeatures = require('./sort_features');\n\nconst mapEventToBoundingBox = require('./map_event_to_bounding_box');\n\nconst Constants = require('../constants');\n\nconst StringSet = require('./string_set');\n\nconst META_TYPES = [Constants.meta.FEATURE, Constants.meta.MIDPOINT, Constants.meta.VERTEX]; // Requires either event or bbox\n\nmodule.exports = function (event, bbox, ctx) {\n  if (ctx.map === null) return [];\n  const box = event ? mapEventToBoundingBox(event, ctx.options.clickBuffer) : bbox;\n  const queryParams = {};\n  if (ctx.options.styles) queryParams.layers = ctx.options.styles.map(s => s.id);\n  const features = ctx.map.queryRenderedFeatures(box, queryParams).filter(feature => {\n    return META_TYPES.indexOf(feature.properties.meta) !== -1;\n  });\n  const featureIds = new StringSet();\n  const uniqueFeatures = [];\n  features.forEach(feature => {\n    const featureId = feature.properties.id;\n    if (featureIds.has(featureId)) return;\n    featureIds.add(featureId);\n    uniqueFeatures.push(feature);\n  });\n  return sortFeatures(uniqueFeatures);\n};","map":{"version":3,"sources":["/Users/jacquelinechen/Desktop/Mapbox/mapbox-react-tutorial/mapboxAndReact/node_modules/mapbox-gl-draw/src/lib/features_at.js"],"names":["sortFeatures","require","mapEventToBoundingBox","Constants","StringSet","META_TYPES","meta","FEATURE","MIDPOINT","VERTEX","module","exports","event","bbox","ctx","map","box","options","clickBuffer","queryParams","styles","layers","s","id","features","queryRenderedFeatures","filter","feature","indexOf","properties","featureIds","uniqueFeatures","forEach","featureId","has","add","push"],"mappings":"AAAA,MAAMA,YAAY,GAAGC,OAAO,CAAC,iBAAD,CAA5B;;AACA,MAAMC,qBAAqB,GAAGD,OAAO,CAAC,6BAAD,CAArC;;AACA,MAAME,SAAS,GAAGF,OAAO,CAAC,cAAD,CAAzB;;AACA,MAAMG,SAAS,GAAGH,OAAO,CAAC,cAAD,CAAzB;;AAEA,MAAMI,UAAU,GAAG,CACjBF,SAAS,CAACG,IAAV,CAAeC,OADE,EAEjBJ,SAAS,CAACG,IAAV,CAAeE,QAFE,EAGjBL,SAAS,CAACG,IAAV,CAAeG,MAHE,CAAnB,C,CAMA;;AACAC,MAAM,CAACC,OAAP,GAAiB,UAASC,KAAT,EAAgBC,IAAhB,EAAsBC,GAAtB,EAA2B;AAC1C,MAAIA,GAAG,CAACC,GAAJ,KAAY,IAAhB,EAAsB,OAAO,EAAP;AAEtB,QAAMC,GAAG,GAAIJ,KAAD,GAAUV,qBAAqB,CAACU,KAAD,EAAQE,GAAG,CAACG,OAAJ,CAAYC,WAApB,CAA/B,GAAkEL,IAA9E;AAEA,QAAMM,WAAW,GAAG,EAApB;AACA,MAAIL,GAAG,CAACG,OAAJ,CAAYG,MAAhB,EAAwBD,WAAW,CAACE,MAAZ,GAAqBP,GAAG,CAACG,OAAJ,CAAYG,MAAZ,CAAmBL,GAAnB,CAAuBO,CAAC,IAAIA,CAAC,CAACC,EAA9B,CAArB;AAExB,QAAMC,QAAQ,GAAGV,GAAG,CAACC,GAAJ,CAAQU,qBAAR,CAA8BT,GAA9B,EAAmCG,WAAnC,EACdO,MADc,CACNC,OAAD,IAAa;AACnB,WAAOtB,UAAU,CAACuB,OAAX,CAAmBD,OAAO,CAACE,UAAR,CAAmBvB,IAAtC,MAAgD,CAAC,CAAxD;AACD,GAHc,CAAjB;AAKA,QAAMwB,UAAU,GAAG,IAAI1B,SAAJ,EAAnB;AACA,QAAM2B,cAAc,GAAG,EAAvB;AACAP,EAAAA,QAAQ,CAACQ,OAAT,CAAkBL,OAAD,IAAa;AAC5B,UAAMM,SAAS,GAAGN,OAAO,CAACE,UAAR,CAAmBN,EAArC;AACA,QAAIO,UAAU,CAACI,GAAX,CAAeD,SAAf,CAAJ,EAA+B;AAC/BH,IAAAA,UAAU,CAACK,GAAX,CAAeF,SAAf;AACAF,IAAAA,cAAc,CAACK,IAAf,CAAoBT,OAApB;AACD,GALD;AAOA,SAAO3B,YAAY,CAAC+B,cAAD,CAAnB;AACD,CAvBD","sourcesContent":["const sortFeatures = require('./sort_features');\nconst mapEventToBoundingBox = require('./map_event_to_bounding_box');\nconst Constants = require('../constants');\nconst StringSet = require('./string_set');\n\nconst META_TYPES = [\n  Constants.meta.FEATURE,\n  Constants.meta.MIDPOINT,\n  Constants.meta.VERTEX\n];\n\n// Requires either event or bbox\nmodule.exports = function(event, bbox, ctx) {\n  if (ctx.map === null) return [];\n\n  const box = (event) ? mapEventToBoundingBox(event, ctx.options.clickBuffer) : bbox;\n\n  const queryParams = {};\n  if (ctx.options.styles) queryParams.layers = ctx.options.styles.map(s => s.id);\n\n  const features = ctx.map.queryRenderedFeatures(box, queryParams)\n    .filter((feature) => {\n      return META_TYPES.indexOf(feature.properties.meta) !== -1;\n    });\n\n  const featureIds = new StringSet();\n  const uniqueFeatures = [];\n  features.forEach((feature) => {\n    const featureId = feature.properties.id;\n    if (featureIds.has(featureId)) return;\n    featureIds.add(featureId);\n    uniqueFeatures.push(feature);\n  });\n\n  return sortFeatures(uniqueFeatures);\n};\n"]},"metadata":{},"sourceType":"script"}